<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Growth Coach</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            width: 400px;
            height: 600px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            overflow: hidden;
        }
        
        .container {
            height: 100%;
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 12px;
            margin: 8px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 12px 12px 0 0;
        }
        
        .header h1 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .toggle-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .toggle {
            position: relative;
            width: 50px;
            height: 24px;
            background: rgba(255,255,255,0.3);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .toggle.active {
            background: rgba(255,255,255,0.8);
        }
        
        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .toggle.active .toggle-slider {
            transform: translateX(26px);
            background: #4facfe;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .tab {
            flex: 1;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            color: #6c757d;
            background: none;
            border: none;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            color: #4facfe;
            background: white;
            border-bottom: 2px solid #4facfe;
        }
        
        .content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #e9ecef transparent;
        }
        
        .content::-webkit-scrollbar {
            width: 6px;
        }
        
        .content::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .content::-webkit-scrollbar-thumb {
            background: #e9ecef;
            border-radius: 3px;
        }
        
        .insight-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        
        .insight-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transform: translateY(-1px);
        }
        
        .insight-card.warning {
            border-left: 4px solid #ff6b6b;
        }
        
        .insight-card.success {
            border-left: 4px solid #51cf66;
        }
        
        .insight-card.opportunity {
            border-left: 4px solid #ffd43b;
        }
        
        .insight-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #495057;
        }
        
        .insight-message {
            font-size: 13px;
            line-height: 1.4;
            color: #6c757d;
            margin-bottom: 8px;
        }
        
        .insight-action {
            font-size: 12px;
            color: #4facfe;
            font-weight: 500;
            background: rgba(79, 172, 254, 0.1);
            padding: 8px;
            border-radius: 4px;
        }
        
        .chart-container {
            margin-bottom: 20px;
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .chart-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #495057;
        }
        
        .chat-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            height: 100%;
        }
        
        .chat-input-group {
            display: flex;
            gap: 8px;
        }
        
        .chat-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s ease;
        }
        
        .chat-input:focus {
            border-color: #4facfe;
        }
        
        .chat-submit {
            padding: 12px 16px;
            background: #4facfe;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s ease;
        }
        
        .chat-submit:hover {
            background: #3d8bfe;
        }
        
        .chat-response {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4facfe;
            font-size: 14px;
            line-height: 1.5;
            color: #495057;
        }
        
        .footer {
            background: #f8f9fa;
            padding: 15px 20px;
            border-top: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 0 0 12px 12px;
        }
        
        .footer-btn {
            background: none;
            border: none;
            color: #6c757d;
            font-size: 12px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        
        .footer-btn:hover {
            background: #e9ecef;
            color: #495057;
        }
        
        .footer-btn.premium {
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            color: white;
            font-weight: 500;
        }
        
        .footer-btn.premium:hover {
            opacity: 0.9;
        }
        
        .loading {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
        }
        
        .loading-spinner {
            width: 32px;
            height: 32px;
            border: 3px solid #e9ecef;
            border-top: 3px solid #4facfe;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .auth-prompt {
            text-align: center;
            padding: 40px 20px;
        }
        
        .auth-btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background 0.3s ease;
        }
        
        .auth-btn:hover {
            background: #3367d6;
        }
        
        .mock-data-notice {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            padding: 10px;
            border-radius: 6px;
            font-size: 12px;
            color: #856404;
            margin-bottom: 15px;
        }
        
        .hidden {
            display: none !important;
        }
        
        .consent-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .consent-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 320px;
            text-align: center;
        }
        
        .consent-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .consent-text {
            font-size: 13px;
            line-height: 1.5;
            color: #6c757d;
            margin-bottom: 20px;
        }
        
        .consent-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .consent-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
        }
        
        .consent-accept {
            background: #4facfe;
            color: white;
        }
        
        .consent-decline {
            background: #e9ecef;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div style="display:flex; align-items:center; justify-content:space-between;">
                <h1 style="margin:0; font-size:18px;">üß† AI Growth Coach</h1>
                <button id="settingsBtn" title="Settings" style="background:none;border:none;color:white;cursor:pointer;font-size:16px;">‚öôÔ∏è</button>
            </div>
            <div class="toggle-container">
                <span>Active Mode</span>
                <div class="toggle active" id="activeToggle">
                    <div class="toggle-slider"></div>
                </div>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab active" data-tab="insights">Quick Insights</button>
            <button class="tab" data-tab="visuals">Visuals</button>
            <button class="tab" data-tab="chat">Ask Me</button>
        </div>
        
        <div class="content" id="content">
            <!-- Content will be loaded here -->
        </div>
        
        <div class="footer">
            <button class="footer-btn" id="exportBtn">üìä Export to Sheets</button>
            <button class="footer-btn" id="privacyBtn">üîí Privacy</button>
            <button class="footer-btn premium" id="upgradeBtn">‚ú® Upgrade Premium</button>
        </div>
    </div>
    
    <!-- Consent Modal -->
    <div class="consent-modal hidden" id="consentModal">
        <div class="consent-content">
            <div class="consent-title">Welcome to AI Growth Coach!</div>
            <div class="consent-text">
                We help you understand your Google Analytics data better. 
                We only access your analytics data and store minimal authentication tokens. 
                No personal data is stored permanently.
            </div>
            <div class="consent-actions">
                <button class="consent-btn consent-accept" id="consentAccept">I Agree</button>
                <button class="consent-btn consent-decline" id="consentDecline">Learn More</button>
            </div>
        </div>
    </div>
    
    <!-- Settings Modal -->
    <div class="consent-modal hidden" id="settingsModal">
        <div class="consent-content">
            <div class="consent-title">Settings</div>
            <div style="text-align:left; margin-bottom:10px;">
                <label style="font-size:13px; color:#495057">Google Analytics Property ID</label>
                <input id="settingsPropertyId" type="text" placeholder="e.g., 123456789" style="width:100%; padding:8px; margin-top:6px; border:1px solid #dee2e6; border-radius:6px;">
            </div>
            <div style="text-align:left; margin-bottom:10px;">
                <label style="font-size:13px; color:#495057">OAuth Client ID (optional)</label>
                <input id="settingsClientId" type="text" placeholder="YOUR_CLIENT_ID.apps.googleusercontent.com" style="width:100%; padding:8px; margin-top:6px; border:1px solid #dee2e6; border-radius:6px;">
            </div>
            <div style="text-align:left; margin-bottom:10px;">
                <label style="font-size:13px; color:#495057">Extension Redirect URI (copy and add to Google Cloud)</label>
                <div style="display:flex; gap:8px; margin-top:6px;">
                    <input id="redirectUri" type="text" readonly style="flex:1; padding:8px; border:1px solid #dee2e6; border-radius:6px; background:#f8f9fa;">
                    <button class="consent-btn" id="copyRedirect">Copy</button>
                </div>
                <div id="redirectHelp" style="font-size:12px; color:#6c757d; margin-top:6px;">Add this redirect URI to your OAuth client's Authorized Redirect URIs in Google Cloud Console.</div>
            </div>
            <div style="display:flex; gap:8px; justify-content:center; margin-top:10px;">
                <button class="consent-btn consent-accept" id="settingsSave">Save</button>
                <button class="consent-btn" id="testAuth">Test OAuth</button>
                <button class="consent-btn consent-decline" id="settingsClose">Close</button>
            </div>
            <p style="font-size:12px; color:#6c757d; margin-top:12px;">Quick setup: 1) Create OAuth client in Google Cloud, 2) Add the redirect URI above to the client, 3) Paste the Client ID here and click "Test OAuth". For production, put the client id in `manifest.json`.</p>
        </div>
    </div>
    
    <script src="vendor/chart.min.js"></script>
    <script src="popup.js"></script>
</body>
</html>